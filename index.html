<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link href="./style.css" rel="stylesheet" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conflict-free Replicated Data Views</title>
  <meta name="description" content="Conflict-free Replicated Data Views brings convergent replicated data to relational database systems." />
  <link rel="canonical" href="https://nuno-faria.github.io/crdv/" />
  <meta property="og:title" content="Conflict-free Replicated Data Views" />
  <meta property="og:description"
    content="Conflict-free Replicated Data Views brings convergent replicated data to relational database systems." />
  <meta property="og:url" content="https://nuno-faria.github.io/crdv/" />
  <meta property="og:site_name" content="Conflict-free Replicated Data Views" />
  <meta property="og:image" content="https://nuno-faria.github.io/crdv/favicon.svg" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="https://nuno-faria.github.io/crdv/favicon.svg" />
  <meta name="twitter:description"
    content="Conflict-free Replicated Data Views brings convergent replicated data to relational database systems." />
  <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="shortcut icon" href="favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="CRDV" />
  <link rel="manifest" href="/site.webmanifest" />
</head>

<body class="max-w-screen-md mx-auto md:py-10 py-4 px-4">
  <header class="text-center mb-8">
    <img class="mx-auto" src="images/logo.svg" width="80px" title="Logo" alt="CRDV logo" />

    <h1>Conflict-free Replicated Data Views</h1>

    <p class="flex flex-wrap justify-center text-lg gap-1">
      <a href="https://nuno-faria.github.io/">Nuno Faria</a> and <a href="https://jopereira.github.io/">José Pereira</a>
    </p>
    <p class="text-lg">INESCTEC & University of Minho</p>
    <p class="text-lg">SIGMOD 2025 (Honorable Mention)</p>

    <p class="flex flex-wrap justify-center gap-1 sm:gap-2 my-4">
      <a class="link-button" href="https://dl.acm.org/doi/pdf/10.1145/3709675">
        <svg class="size-5" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100"
          viewBox="0 0 24 24">
          <path
            d="M 6 2 C 4.9057453 2 4 2.9057453 4 4 L 4 20 C 4 21.094255 4.9057453 22 6 22 L 18 22 C 19.094255 22 20 21.094255 20 20 L 20 8 L 14 2 L 6 2 z M 6 4 L 13 4 L 13 9 L 18 9 L 18 20 L 6 20 L 6 4 z M 8 12 L 8 14 L 16 14 L 16 12 L 8 12 z M 8 16 L 8 18 L 16 18 L 16 16 L 8 16 z">
          </path>
        </svg>
        Paper
      </a>
      <a class="link-button" href="https://github.com/nuno-faria/crdv">
        <svg class="size-5" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100"
          viewBox="0 0 30 30">
          <path
            d="M15,3C8.373,3,3,8.373,3,15c0,5.623,3.872,10.328,9.092,11.63C12.036,26.468,12,26.28,12,26.047v-2.051 c-0.487,0-1.303,0-1.508,0c-0.821,0-1.551-0.353-1.905-1.009c-0.393-0.729-0.461-1.844-1.435-2.526 c-0.289-0.227-0.069-0.486,0.264-0.451c0.615,0.174,1.125,0.596,1.605,1.222c0.478,0.627,0.703,0.769,1.596,0.769 c0.433,0,1.081-0.025,1.691-0.121c0.328-0.833,0.895-1.6,1.588-1.962c-3.996-0.411-5.903-2.399-5.903-5.098 c0-1.162,0.495-2.286,1.336-3.233C9.053,10.647,8.706,8.73,9.435,8c1.798,0,2.885,1.166,3.146,1.481C13.477,9.174,14.461,9,15.495,9 c1.036,0,2.024,0.174,2.922,0.483C18.675,9.17,19.763,8,21.565,8c0.732,0.731,0.381,2.656,0.102,3.594 c0.836,0.945,1.328,2.066,1.328,3.226c0,2.697-1.904,4.684-5.894,5.097C18.199,20.49,19,22.1,19,23.313v2.734 c0,0.104-0.023,0.179-0.035,0.268C23.641,24.676,27,20.236,27,15C27,8.373,21.627,3,15,3z">
          </path>
        </svg>
        Code
      </a>
      <a class="link-button" href="https://nuno-faria.github.io/papers/crdv-poster.pdf">
        <svg class="size-5" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100"
          viewBox="0 0 24 24">
          <path
            d="M 6 2 C 4.9057453 2 4 2.9057453 4 4 L 4 20 C 4 21.094255 4.9057453 22 6 22 L 18 22 C 19.094255 22 20 21.094255 20 20 L 20 8 L 14 2 L 6 2 z M 6 4 L 13 4 L 13 9 L 18 9 L 18 20 L 6 20 L 6 4 z M 13.5 13.333984 L 11 16.667969 L 9.5 14.667969 L 7 18 L 17 18 L 13.5 13.333984 z">
          </path>
        </svg>
        Poster
      </a>
      <a class="link-button" href="https://files.atypon.com/acm/daccba87f80ed6d216a52bfc673ba7c6">
        <svg class="size-5" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100"
          viewBox="0 0 24 24">
          <path
            d="M 12 4 C 12 4 5.7455469 3.9999687 4.1855469 4.4179688 C 3.3245469 4.6479688 2.6479687 5.3255469 2.4179688 6.1855469 C 1.9999687 7.7455469 2 12 2 12 C 2 12 1.9999687 16.254453 2.4179688 17.814453 C 2.6479687 18.675453 3.3255469 19.352031 4.1855469 19.582031 C 5.7455469 20.000031 12 20 12 20 C 12 20 18.254453 20.000031 19.814453 19.582031 C 20.674453 19.352031 21.352031 18.674453 21.582031 17.814453 C 22.000031 16.254453 22 12 22 12 C 22 12 22.000031 7.7455469 21.582031 6.1855469 C 21.352031 5.3255469 20.674453 4.6479688 19.814453 4.4179688 C 18.254453 3.9999687 12 4 12 4 z M 12 6 C 14.882 6 18.490875 6.1336094 19.296875 6.3496094 C 19.465875 6.3946094 19.604391 6.533125 19.650391 6.703125 C 19.891391 7.601125 20 10.342 20 12 C 20 13.658 19.891391 16.397875 19.650391 17.296875 C 19.605391 17.465875 19.466875 17.604391 19.296875 17.650391 C 18.491875 17.866391 14.882 18 12 18 C 9.119 18 5.510125 17.866391 4.703125 17.650391 C 4.534125 17.605391 4.3956094 17.466875 4.3496094 17.296875 C 4.1086094 16.398875 4 13.658 4 12 C 4 10.342 4.1086094 7.6011719 4.3496094 6.7011719 C 4.3946094 6.5331719 4.533125 6.3946094 4.703125 6.3496094 C 5.508125 6.1336094 9.118 6 12 6 z M 10 8.5351562 L 10 15.464844 L 16 12 L 10 8.5351562 z">
          </path>
        </svg>
        Presentation
      </a>
    </p>
  </header>

  <hr />

  <main>
    <section>
      <h2>Overview</h2>
      <p>
        Conflict-free Replicated Data Views (CRDV) brings convergent replicated data to relational
        database systems using native features such as <b>views and rules/triggers</b>. This allows
        replicas to commit writes independently and later merge them with guarantees that they end up
        with the same state, using <b>user-defined resolution rules</b> in SQL to better accommodate
        the target applications.
      </p>
      <p>
        Unlike alternatives that encode Conflict-free Replicated Data Types (CRDTs) as blobs in a
        field and use custom code to read and write, CRDV enables a <b>tight integration with the
          query language and optimizer</b>, and makes it possible to use native <b>secondary
          indexes</b>.
      </p>
      <p>
        Unlike alternatives that model tables as last-writer-wins maps, CRDV supports a <b>wide range
          of types and resolution rules.</b>
      </p>
    </section>

    <hr />

    <section>
      <h2>Architecture</h2>
      <figure>
        <img src="images/architecture.png" width="100%" title="CRDV architecture" alt="Diagram of the CRDV architecture" />
        <figcaption><b>Figure 1:</b> CRDV architecture.</figcaption>
      </figure>
      <p>
        CRDV is comprised of three layers:
      </p>
      <ul class="pl-4">
        <li>
          <b>History</b> - stores local and remote writes, using a replicated table.
        </li>
        <li>
          <b>Present</b> - filters the obsolete rows from the History layer, using a view with
          optional materialization.
        </li>
        <li>
          <b>Value</b> - handles concurrent versions in the Present layer, using conflict-resolution
          rules defined with SQL views.
        </li>
      </ul>

      <section>
        <h3>Schema</h3>
        <p>
          Consider a generic application schema <b>k</b> and <b>v</b>. In addition to these columns,
          the Present and History layer contain the following metadata:
        </p>
        <ul class="pl-4">
          <li>
            <b>op</b> - whether the row was marked as added or removed.
          </li>
          <li>
            <b>site</b> - the node where the row was created.
          </li>
          <li>
            <b>lts</b> - logical timestamp, to track causality.
          </li>
          <li>
            <b>pts</b> - physical timestamp, for last-writer-wins semantics.
          </li>
        </ul>
        <p>
          Meanwhile, the Value layer contains only the data.
        </p>
      </section>

      <section>
        <h3>Writing</h3>
        <p>
          Inserts/Updates/Deletes sent to the Value layer are <b>redirected using rules/triggers as
            Inserts to the History layer</b>, with the new data and additional metadata.
          They are then stored and replicated to the remaining sites.
        </p>
        <p>
          Writes can take advantage of the <b>local transactional guarantees</b> in order to modify
          multiple rows atomically, which are also atomically replicated on commit.
        </p>
        <p>
          Here is an example of a rule that translates Updates (PostgreSQL syntax):
        </p>
        <pre class="code" style="color:#eef0f9" tabindex="0"><code><span class="line"><span style="color:#54B9FF">CREATE</span><span style="color:#54B9FF"> RULE</span><span style="color:#00DAEF"> update_rule</span><span style="color:#54B9FF"> AS</span></span>
<span class="line"><span style="color:#54B9FF">  ON</span><span style="color:#54B9FF"> UPDATE</span><span style="color:#54B9FF"> TO</span><span style="color:#54B9FF"> Value</span><span style="color:#EEF0F9"> DO </span><span style="color:#54B9FF">INSTEAD</span></span>
<span class="line"><span style="color:#54B9FF">  INSERT INTO</span><span style="color:#EEF0F9"> History</span></span>
<span class="line"><span style="color:#54B9FF">  SELECT</span><span style="color:#EEF0F9"> k, v, </span><span style="color:#FFD493">'add'</span><span style="color:#EEF0F9">, siteId(), </span><span style="color:#FFD493">t</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">lts</span><span style="color:#EEF0F9">, </span><span style="color:#FFD493">t</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">pts</span></span>
<span class="line"><span style="color:#54B9FF">  FROM</span><span style="color:#EEF0F9"> nextTimestamp() </span><span style="color:#54B9FF">AS</span><span style="color:#EEF0F9"> t;</span></span>
<span class="line"></span></code></pre>
      </section>

      <section>
        <h3>Filtering</h3>
        <p>
          The Present layer is responsible for <b>removing rows that have been causally replaced</b>,
          meaning they will not be included in the final result. This makes Value easier to
          implement, as it only has to focus on the concurrent present versions.
        </p>
        <p>
          The following figure shows rows being filtered from History to Present. In this case, we
          have two different items, <b>k1</b> and <b>k2</b>. Version <b>[1, 1]</b> in <b>k1</b> is
          obsolete ([1, 1] &lt; [2, 1] and [1, 1] &lt; [1, 2]), while versions <b>[2, 1]</b> and
          <b>[1, 2]</b> are concurrent. As for item <b>k2</b>, version <b>[2, 3]</b> is obsolete
          ([2, 3] &lt; [3, 3]).
        </p>
        <figure>
          <img src="images/filtering.png" width="100%" title="Filtering example" alt="Example showing how rows are filtered from History to Present" />
          <figcaption>
            <b>Figure 2:</b> Example showing how rows are filtered from History to Present.
          </figcaption>
        </figure>
        <p>
          Present can be implemented using three strategies, which can be changed based on the
          workload:
        </p>
        <ul class="pl-4">
          <li>
            <b>no-mat</b> - Present is defined as a view over History that filters the rows at
            runtime. Trades off read performance for write performance.
            (Not used in practice, see the async strategy.)
          </li>
          <li>
            <b>sync</b> - Present is defined as a table that is eagerly materialized on writes to
            History, using a trigger that runs in the same transaction. It also removes the obsolete
            rows from Present. Trades off write performance for read performance.
          </li>
          <li>
            <b>async</b> - Present is defined as a view that combines recent History rows with a
            materialized snapshot. Periodically, History data gets merged into the snapshot. Like
            the no-mat strategy, it trades off read performance for write performance, but the
            periodic materialization helps keep read costs relatively lower.
          </li>
        </ul>
      </section>

      <section>
        <h3>Reading</h3>
        <p>
          Finally, the Value layer will merge concurrent Present rows based on resolution rules
          defined in <b>SQL views</b>, in order to support reads.
        </p>
        <div class="grid sm:grid-cols-2 grid-cols-1">
          <div>
            <p>
              The following image shows an example of data in the Present layer, comprised of four
              different items:
            </p>
            <ul class="pl-4">
              <li>
                <b>k1</b> - one version, marked as added.
              </li>
              <li>
                <b>k2</b> - one version, marked as removed.
              </li>
              <li>
                <b>k3</b> - two versions, one marked as added and the other as removed.
              </li>
              <li>
                <b>k4</b> - two versions, both marked as added.
              </li>
            </ul>
          </div>
          <figure class="my-3">
            <img class="mx-auto" src="images/read_present.png" width="80%" title="Present data" alt="Example data in the Present layer" />
            <figcaption>
              <b>Figure 3:</b> Example of rows in the Present layer.
            </figcaption>
          </figure>
        </div>
        <p>
          Let's say we want to use the <b>add-wins</b> rule, which favors added rows over removed
          ones. This can be defined with the following SQL view:
        </p>
        <div class="grid sm:grid-cols-3 xs:grid-cols-2 grid-cols-1 gap-2">
          <div class="sm:col-span-2">
            <pre class="code" style="color:#eef0f9" tabindex="0"><code><span class="line"><span style="color:#54B9FF">CREATE</span><span style="color:#54B9FF"> VIEW</span><span style="color:#00DAEF"> ValueAw</span><span style="color:#54B9FF"> AS</span></span>
<span class="line"><span style="color:#54B9FF">  SELECT</span><span style="color:#EEF0F9"> k, v</span></span>
<span class="line"><span style="color:#54B9FF">  FROM</span><span style="color:#EEF0F9"> Present</span></span>
<span class="line"><span style="color:#54B9FF">  WHERE</span><span style="color:#EEF0F9"> op = </span><span style="color:#FFD493">'add'</span><span style="color:#EEF0F9">;</span></span>
<span class="line"></span></code></pre>
          </div>
          <figure class="my-4">
            <img class="mx-auto xs:w-3/6 w-2/6" src="images/read_aw.png" title="Add-wins view" alt="Add-wins result set" />
            <figcaption>
              <b>Figure 4:</b> Add-wins view.
            </figcaption>
          </figure>
        </div>
        <p>
          In the example above, a concurrent add and remove conflict is solved by discarding the
          remove. However, we still need to deal with concurrent added rows. We can simply return all
          values, as done by the view above, or aggregate them into an array, i.e.,
          <b>multi-value register</b> approach:
        </p>
        <div class="grid sm:grid-cols-3 xs:grid-cols-2 grid-cols-1 gap-2">
          <div class="sm:col-span-2">
            <pre class="code" style="color:#eef0f9" tabindex="0"><code><span class="line"><span style="color:#54B9FF">CREATE</span><span style="color:#54B9FF"> VIEW</span><span style="color:#00DAEF"> ValueAwMvr</span><span style="color:#54B9FF"> AS</span></span>
<span class="line"><span style="color:#54B9FF">  SELECT</span><span style="color:#EEF0F9"> k, array_agg(v </span><span style="color:#54B9FF">ORDER BY</span><span style="color:#EEF0F9"> v) v</span></span>
<span class="line"><span style="color:#54B9FF">  FROM</span><span style="color:#EEF0F9"> ValueAw</span></span>
<span class="line"><span style="color:#54B9FF">  GROUP BY</span><span style="color:#EEF0F9"> k;</span></span>
<span class="line"></span></code></pre>
          </div>
          <figure class="my-4">
            <img class="mx-auto xs:w-3/6 w-2/6" src="images/read_awmvr.png" title="Add-wins + multi-value register view." alt="Add-wins + multi-value register result set" />
            <figcaption>
              <b>Figure 5:</b> Add-wins + multi-value register view.
            </figcaption>
          </figure>
        </div>
        <p>
          Notice how <code>ValueAwMvr</code> is built on top of the <code>ValueAw</code> view. Another
          option would be to return the <b>average</b> of the conflicting values instead, as shown in
          the example below.
        </p>
        <div class="grid sm:grid-cols-3 xs:grid-cols-2 grid-cols-1 gap-2">
          <div class="sm:col-span-2">
            <pre class="code" style="color:#eef0f9" tabindex="0"><code><span class="line"><span style="color:#54B9FF">CREATE</span><span style="color:#54B9FF"> VIEW</span><span style="color:#00DAEF"> ValueAwAvg</span><span style="color:#54B9FF"> AS</span></span>
<span class="line"><span style="color:#54B9FF">  SELECT</span><span style="color:#EEF0F9"> k, avg(v)</span></span>
<span class="line"><span style="color:#54B9FF">  FROM</span><span style="color:#EEF0F9"> ValueAw</span></span>
<span class="line"><span style="color:#54B9FF">  GROUP BY</span><span style="color:#EEF0F9"> k;</span></span>
<span class="line"></span></code></pre>
          </div>
          <figure class="my-4">
            <img class="mx-auto xs:w-3/6 w-2/6" src="images/read_awavg.png" title="Add-wins + average view" alt="Add-wins + average result set" />
            <figcaption>
              <b>Figure 6:</b> Add-wins + average view.
            </figcaption>
          </figure>
        </div>
        <p>
          Finally, as a last example, the following view applies the <b>last-writer-wins rule</b>,
          using a ranking window function to order the versions by physical timestamp for each item:
        </p>
        <div class="grid sm:grid-cols-3 xs:grid-cols-2 grid-cols-1 gap-2">
          <div class="sm:col-span-2">
            <pre class="code" style="color:#eef0f9" tabindex="0"><code><span class="line"><span style="color:#54B9FF">CREATE</span><span style="color:#54B9FF"> VIEW</span><span style="color:#00DAEF"> ValueLww</span><span style="color:#54B9FF"> AS</span></span>
<span class="line"><span style="color:#54B9FF">  SELECT</span><span style="color:#EEF0F9"> k, v</span></span>
<span class="line"><span style="color:#54B9FF">  FROM</span><span style="color:#EEF0F9"> (</span></span>
<span class="line"><span style="color:#54B9FF">    SELECT</span><span style="color:#EEF0F9"> k, v, op, rank() </span><span style="color:#54B9FF">OVER</span><span style="color:#EEF0F9"> (</span></span>
<span class="line"><span style="color:#54B9FF">        PARTITION</span><span style="color:#54B9FF"> BY</span><span style="color:#EEF0F9"> k</span></span>
<span class="line"><span style="color:#54B9FF">        ORDER BY</span><span style="color:#EEF0F9"> pts </span><span style="color:#54B9FF">DESC</span><span style="color:#EEF0F9">, </span><span style="color:#54B9FF">site</span></span>
<span class="line"><span style="color:#EEF0F9">      ) </span><span style="color:#54B9FF">AS</span><span style="color:#EEF0F9"> rank</span></span>
<span class="line"><span style="color:#54B9FF">    FROM</span><span style="color:#EEF0F9"> Present</span></span>
<span class="line"><span style="color:#EEF0F9">  )</span></span>
<span class="line"><span style="color:#54B9FF">  WHERE</span><span style="color:#EEF0F9"> rank = </span><span style="color:#FFD493">1</span><span style="color:#54B9FF"> AND</span><span style="color:#EEF0F9"> op = </span><span style="color:#FFD493">'add'</span><span style="color:#EEF0F9">;</span></span>
<span class="line"></span></code></pre>
          </div>
          <figure class="my-4">
            <img class="mx-auto xs:w-3/6 w-2/6" src="images/read_lww.png" title="Last-writer-wins view" alt="Last-writer-wins result set" />
            <figcaption>
              <b>Figure 7:</b> Last-writer-wins view.
            </figcaption>
          </figure>
        </div>
      </section>
    </section>

    <hr />

    <section>
      <h2>Reproducing CRDTs & Nested Structures</h2>
        <p>
          Common CRDTs can be implemented with CRDV. Examples include:
        </p>
        <ul class="pl-4 mb-6">
          <li>
            <b>registers</b> - using single-row tables (however, they will usually be found inside
            maps).
          </li>
          <li>
            <b>maps</b> - table with two columns, a key and value, like the examples previously shown.
          </li>
          <li>
            <b>sets</b> - similar to maps, but without the value column.
          </li>
          <li>
            <b>lists</b> - also uses two columns, with the key being used to order the values in the
            list.
            The <a href="https://hal.science/hal-00921633/file/fp025-nedelec.pdf">LSEQ algorithm</a>
            can be used to generate such keys.
          </li>
          <li>
            <b>counters</b> - also use a key and a value. The key represents the origin site, while
            the value represents the partial sum. Each site can increment or decrement its respective
            row, while the local concurrency control ensures that there are no local concurrent
            versions. To read the final value, we just need to perform a sum.
          </li>
        </ul>
        <p>
          We can also use <b>foreign keys to represent nested structures</b>, similarly to how we can
          add CRDTs inside CRDTs. To materialize the result, we just need to join the respective Value
          views. For example, consider a table that stores shopping carts. For every product in each
          cart, there is a foreign key to the quantity, modeled in a separate table as a counter.
          <code>CartAw</code> is a view that builds the shopping carts using the add-wins rule, while
          <code>Quantity</code> is a view that builds the counters. The final shopping carts can then
          be queried as such:
        </p>
        <pre class="code" style="color:#eef0f9" tabindex="0"><code><span class="line"><span style="color:#54B9FF">SELECT</span><span style="color:#FFD493"> c</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">id</span><span style="color:#EEF0F9">, </span><span style="color:#FFD493">c</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">product_id</span><span style="color:#EEF0F9">, </span><span style="color:#FFD493">q</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">amount</span></span>
<span class="line"><span style="color:#54B9FF">FROM</span><span style="color:#EEF0F9"> CartAw c</span></span>
<span class="line"><span style="color:#54B9FF">JOIN</span><span style="color:#EEF0F9"> Quantity q </span><span style="color:#54B9FF">ON</span><span style="color:#FFD493"> q</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">id</span><span style="color:#EEF0F9"> = </span><span style="color:#FFD493">c</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">quantity_id</span><span style="color:#EEF0F9">;</span></span>
<span class="line"></span></code></pre>
        <p>
          Alternatively, we can return the result set as JSON:
        </p>
        <pre class="code" style="color:#eef0f9" tabindex="0"><code><span class="line"><span style="color:#54B9FF">SELECT</span><span style="color:#FFD493"> c</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">id</span><span style="color:#EEF0F9">, jsonb_object_agg(</span><span style="color:#FFD493">c</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">product_id</span><span style="color:#EEF0F9">, </span><span style="color:#FFD493">q</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">amount</span><span style="color:#EEF0F9">)</span></span>
<span class="line"><span style="color:#54B9FF">FROM</span><span style="color:#EEF0F9"> CartAw c</span></span>
<span class="line"><span style="color:#54B9FF">JOIN</span><span style="color:#EEF0F9"> Quantity q </span><span style="color:#54B9FF">ON</span><span style="color:#FFD493"> q</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">id</span><span style="color:#EEF0F9"> = </span><span style="color:#FFD493">c</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">quantity_id</span></span>
<span class="line"><span style="color:#54B9FF">GROUP BY</span><span style="color:#FFD493"> c</span><span style="color:#EEF0F9">.</span><span style="color:#FFD493">id</span><span style="color:#EEF0F9">;</span></span>
<span class="line"></span></code></pre>
        <p>
          One problem with this approach is that if we remove a product <code>p</code> from a cart while
          concurrently incrementing its quantity, the add-wins view will not select <code>p</code>,
          since it does not know of the add done on the quantity table. To ensure
          <b>referential integrity</b>, we can create a trigger that marks a product as added in the
          cart table when there is an update on the respective counter, "entangling" both structures.
        </p>
    </section>
    <hr />

    <section>
      <h2>Proof of Concept</h2>
      <p>
        We implemented a proof of concept of CRDV in PostgreSQL, using rules/triggers, views,
        procedures, and the built-in asynchronous logical replication.
      </p>
      <p>
        The <a href="https://github.com/nuno-faria/crdv">repository</a> contains the code and
        instructions to test it.
      </p>
    </section>

    <hr />

    <section>
      <h2>Citation</h2>

      <section>
        <h3>Text</h3>
        <pre class="code"
          tabindex="0"><code><span class="line"><span>Nuno Faria and José Pereira. 2025. CRDV: Conflict-free Replicated Data Views. Proc. ACM Manag. Data 3, 1, Article 25 (February 2025), 27 pages. https://doi.org/10.1145/3709675</span></span></code></pre>
      </section>

      <section>
        <h3>BibTeX</h3>
        <pre class="code" style="color:#eef0f9" tabindex="0"><code><span class="line"><span style="color:#54B9FF">@article</span><span style="color:#EEF0F9">{</span><span style="color:#ACAFFF">crdv</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  author     = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">Faria, Nuno and Pereira, José</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  title      = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">CRDV: Conflict-free Replicated Data Views</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  year       = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">2025</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  issue_date = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">February 2025</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  publisher  = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">Association for Computing Machinery</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  address    = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">New York, NY, USA</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  volume     = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">3</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  number     = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">1</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  url        = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">https://doi.org/10.1145/3709675</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  doi        = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">10.1145/3709675</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  abstract   = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">There are now multiple proposals for Conflict-free Replicated Data Types (CRDTs) in SQL databases aimed at distributed systems. Some, such as ElectricSQL, provide only relational tables as convergent replicated maps, but this omits semantics that would be useful for merging updates. Others, such as Pg_crdt, provide access to a rich library of encapsulated column types. However, this puts merge and query processing outside the scope of the query optimizer and restricts the ability of an administrator to influence access paths with materialization and indexes.Our proposal, CRDV, overcomes this challenge by using two layers implemented as SQL views: The first provides a replicated relational table from an update history, while the second implements varied and rich types on top of the replicated table. This allows the definition of merge semantics, or even entire new data types, in SQL itself, and enables global optimization of user queries together with merge operations. Therefore, it naturally extends the scope of query optimization and local transactions to operations on replicated data, can be used to reproduce the functionality of common CRDTs with simple SQL idioms, and results in better performance than alternatives.</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  journal    = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">Proc. ACM Manag. Data</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  month      = feb,</span></span>
<span class="line"><span style="color:#EEF0F9">  articleno  = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">25</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  numpages   = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">27</span><span style="color:#FFD493">}</span><span style="color:#EEF0F9">,</span></span>
<span class="line"><span style="color:#EEF0F9">  keywords   = </span><span style="color:#FFD493">{</span><span style="color:#EEF0F9">crdts, distributed databases, geo-replication, local-first software</span><span style="color:#FFD493">}</span></span>
<span class="line"><span style="color:#EEF0F9">}</span></span>
<span class="line"></span></code></pre>
      </section>
    </section>
  </main>

  <footer>
    <hr />
    <p>Conflict-free Replicated Data Views</p>
    <p>Nuno Faria (nuno.f.faria [at] inesctec.pt)</p>
  </footer>

</body>

</html>
